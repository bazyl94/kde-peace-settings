#!/bin/bash 
function_load_profiles(){
profilefile="$1"
profilefile="/home/shared/2015/test/kde-peace-settings/kde-services-menu/kde-service-menu-vlctranscode/profiles.lst5"
# set -x 
k=0
while read line; do 

nameprofile[$k]="$(echo "$line" | awk -F'//' '{print $1}')"
vlcoptionprofile[$k]="$(echo "$line" | awk -F'//' '{print $2}' )"
 
outformat[$k]="$(echo "$line" | awk -F'//' '{gsub(/mux=/,"");print $3}' )"
k=$(( $k+1 ))
done < "$profilefile" 
# set +x
}

function_menu(){
function_load_profiles 
# set -x
ARGS="--menu \"choose your profile\" --"
for ((i=0; i<${#nameprofile[@]}; i++)); do
    ARGS="$ARGS \"${vlcoptionprofile[$i]}\" \"${nameprofile[$i]}\""
done


SELECTED_OPTIONS=$(echo $ARGS | xargs kdialog)
echo $SELECTED_OPTIONS

 

for ((i=0; i<${#nameprofile[@]}; i++)); do

	if [[ "${vlcoptionprofile[i]}" == "$SELECTED_OPTIONS" ]] ; then  
		profileindex=$i
	fi 
 
done 
echo"outformat: ${outformat[$profileindex]} profile parameters: $SELECTED_OPTIONS"
# set +x
}
function_menu